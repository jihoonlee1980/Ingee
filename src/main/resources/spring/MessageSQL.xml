<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com2">
	<select id="getRecvMessageCount" parameterType="String" resultType="int">
		select count(*) from message where receiver = #{id}
	</select>
	
	<select id="getRecvMessageList" parameterType="HashMap" resultType="com.menu.model.MessageDTO">
		select * from message where 
		<choose>             
             <when test="DISC == 'recv'">
                 receiver
             </when>                            
             <otherwise>
                 sender
             </otherwise>             
         </choose>
		 = #{id} order by date_sent desc limit #{startPage} , #{perPage}
	</select>
	
	<select id="getMessageContent" parameterType="int" resultType="HashMap">
		select * from message where num = #{num}
	</select>
	
	<select id="messageIdcheck" parameterType="String" resultType="String">
		select id from member where id = #{id}
	</select>
	
	<insert id="sendMessage" parameterType="HashMap">
		<selectKey keyProperty="no" resultType="java.lang.Integer">
		SELECT @@IDENTITY AS no
		</selectKey>
		insert into message values (
		null ,
		#{sender} ,
		#{receiver} ,
		#{subject} ,
		#{content} ,
		now() ,
		null ,
		0
		);
	</insert>
	
	<delete id="deleteMessage" parameterType="int">
		delete from message where num = #{num}
	</delete>
</mapper>